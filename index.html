<!--
  Requirement: Create the Course Homepage

  Instructions:
  This page will serve as the main entry point to the course website.
  It should contain a simple navigation menu with links to all the key pages.
-->
<!DOCTYPE html>
<html lang="en">
<head>
     <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
     <title>Web Dev Course Homepage</title>
     <link rel="stylesheet" type="text/css" href="src/common/styles.css">
    <!-- TODO: Add the 'meta' tag for character encoding (UTF-8). -->
    
    <!-- TODO: Add the responsive 'viewport' meta tag. -->

    <!-- TODO: Add a title, e.g., "Web Dev Course Homepage". -->

    <!-- TODO: Link to your CSS framework or stylesheet. -->
</head>
<body>
     <header>
          <h1>Welcome to the Web Development Course</h1>
          <div id="auth-status">
        </div>
     </header>
     <main>
          <nav>
               <h2>Site Navigation</h2>
               <ul id="nav-links">
                    <li id="login-li">
                         <a href="src/auth/login.html" id="login-link">Login</a>
                    </li>
                    <li>
                         <a href="src/admin/manage_users.html">Admin Portal (Manage Students)</a>
                    </li>
                    <li>
                         <a href="src/resources/admin.html">Admin: Manage Resources</a>
                    </li>
                    <li>
                         <a href="src/weekly/admin.html">Admin: Manage Weekly Breakdown</a>
                    </li>
                    <li>
                         <a href="src/assignments/admin.html">Admin: Manage Assignments</a>
                    </li>
                    <li>
                         <a href="src/resources/list.html">View Course Resources</a>
                    </li>
                    <li>
                         <a href="src/weekly/list.html">View Weekly Breakdown</a>
                    </li>
                    <li>
                         <a href="src/assignments/list.html">View Assignments</a>
                    </li>
                    <li>
                         <a href="src/discussion/baord.html">General Discussion Board</a>
                    </li>
               </ul>
          </nav>
     </main>

    <!-- TODO: Create a 'header' with a main heading ('h1') like "Welcome to the Web Development Course". -->

    <!-- TODO: Create the 'main' content area. -->

        <!-- TODO: Create a 'nav' element to hold the site navigation. -->
            <!-- TODO: Add a sub-heading ('h2') "Site Navigation". -->

            <!-- TODO: Create an unordered list ('ul') to hold the links. -->

                <!-- Section: General -->
                <!-- TODO: Add a list item ('li') with a link ('a') to the Login page.
                     - Text: "Login" -->

                <!-- Section: Admin Pages -->
                <!-- TODO: Add a list item ('li') with a link ('a') to the Admin Portal.
                     - Text: "Admin Portal (Manage Students)" -->
                
                <!-- TODO: Add a list item ('li') with a link ('a') to the Admin Resources page.
                     - Text: "Admin: Manage Resources" -->

                <!-- TODO: Add a list item ('li') with a link ('a') to the Admin Weekly Breakdown page.
                     - Text: "Admin: Manage Weekly Breakdown" -->

                <!-- TODO: Add a list item ('li') with a link ('a') to the Admin Assignments page.
                     - Text: "Admin: Manage Assignments" -->

                <!-- Section: Student Pages -->
                <!-- TODO: Add a list item ('li') with a link ('a') to the Student Resources page.
                     - Text: "View Course Resources" -->

                <!-- TODO: Add a list item ('li') with a link ('a') to the Student Weekly Breakdown page.
                     - Text: "View Weekly Breakdown" -->

                <!-- TODO: Add a list item ('li') with a link ('a') to the Student Assignments page.
                     - Text: "View Assignments" -->
              
                <!-- TODO: Add a list item ('li') with a link ('a') to the Discussion Board.
                     - Text: "General Discussion Board" -->


            <!-- End of the unordered list. -->
        <!-- End of the 'nav' element. -->

    <!-- End of 'main'. -->

    <script>
        // Check if user is logged in
        async function checkAuthStatus() {
            try {
                // Try to get user info from session
                const response = await fetch('/src/auth/api/index.php?check=1', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.user) {
                        // User is logged in
                        updateUIForLoggedInUser(data.user);
                        return data.user;
                    }
                }
            } catch (error) {
                console.log('Auth check:', error.message);
            }
            
            // User is not logged in
            updateUIForLoggedOutUser();
            return null;
        }
        
        function updateUIForLoggedInUser(user) {
            const authStatus = document.getElementById('auth-status');
            const loginLi = document.getElementById('login-li');
            const loginLink = document.getElementById('login-link');
            
            // Update auth status display
            if (authStatus) {
                authStatus.innerHTML = `
                    <span style="margin-right: 15px; color: #666;">
                        Welcome, ${user.name} (${user.is_admin ? 'Admin' : 'Student'})
                    </span>
                    <button id="logout-btn" class="logout-btn">Logout</button>
                `;
                
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', handleLogout);
                }
            }
            
          }
        
        function updateUIForLoggedOutUser() {
          const authStatus = document.getElementById('auth-status');
          const loginLi = document.getElementById('login-li');
          const loginLink = document.getElementById('login-link');
            
          if (authStatus) {
               authStatus.innerHTML = '';
          }
            
          if (loginLink) {
               loginLink.textContent = 'Login';
               loginLink.href = 'src/auth/login.html';
          }
        }
        
        async function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    const response = await fetch('/src/auth/api/logout.php', {
                        method: 'POST',
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        updateUIForLoggedOutUser();
                        
                        alert('Logged out successfully!');
                        
                        window.location.reload();
                    } else {
                        alert('Logout failed. Please try again.');
                    }
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Network error. Please check your connection.');
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
        });
    </script>
</body>
</html>
